@{Layout = null;
string passwordPattern = ".{8,}";
string key = "";
try
{
    key = ViewData["key"].ToString();
}
catch { }
}
<!DOCTYPE html>

<html>
<head>
    <meta charset="utf-8">
    <title>HTK - CAFI WEB</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <!-- Le styles -->
    <link href=" ~/Content/css/bootstrap.css" rel="stylesheet">
    <link href="~/Content/css/bootstrap-responsive.css" rel="stylesheet">
    <link href="~/Content/css/stylesheet.css" rel="stylesheet">
    <link href="~/Content/css/loginStyle.css" rel="stylesheet">
    <link href="~/Content/css/design/loginform.css" rel="stylesheet">
    <link href="~/Content/icon/font-awesome.css" rel="stylesheet">
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,300,600,700,800' rel='stylesheet' type='text/css'>
    <script src="~/Content/Scripts/jquery-1.10.2.js"></script>
    <script src="~/Content/Scripts/jquery-ui-1.10.3.js"></script>
    <script src="~/Content/Scripts/bootstrap.js"></script>

    <!-- Le fav and touch icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="~/Content/img/apple-touch-icon-144-precomposed.html">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="~/Content/img/apple-touch-icon-114-precomposed.html">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="~/Content/img/apple-touch-icon-72-precomposed.html">
    <link rel="apple-touch-icon-precomposed" href="~/Content/img/apple-touch-icon-57-precomposed.html">
    <link rel="shortcut icon" href="~/Uploads/Images/Design/Favicon/favicon.png">
</head>
<body>
    <div style="width: 35%; margin-left: 35%">
        <div class="login-header">

            <p class="Login-text">Crear Contraseña</p>
        </div>
        <form id="user-customer_Form" method="post" autocomplete="off">
            <input type="hidden" id="keypwd" value="@key"/>
            <div class="modal-body">
                <div id="firmaContent" class="staticField">
                    
                    <table width="100%">
                      
                       <tr>
                            <td width="50%"><h10>Nueva contraseña: </h10></td>
                            <td><input type="password" id="newPassword" pattern=@passwordPattern placeholder="Nueva contraseña" data-original-title="Mínimo 8 caracteres con por lo menos; una minúscula, una mayúscula, un número y un símbolo." rel="tooltip" data-placement="right"></input></td>
                        </tr>
                        <tr>
                            <td width="50%"><h10>Repetir nueva contraseña: </h10></td>
                            <td><input type="password" id="repeatNewPassword" pattern=@passwordPattern placeholder="Repetir nueva contraseña" data-original-title="Mínimo 8 caracteres con por lo menos; una minúscula, una mayúscula, un número y un símbolo." rel=" tooltip" data-placement="right"></input></td>
                        </tr>
                    </table>
                    <div id="messagesModal"></div>
                </div>
            </div>
            <div class="modal-footer">
                <span width="80%" class="error_msg"></span>
                <input value="Aceptar" class="btn dark_green" type="button" id="save_chgPasswordExp">
            </div>
        </form>
    </div>
</body>
</html>
<script src="~/Content/Scripts/jquery-1.10.2.js"></script>
<script src="~/Content/Scripts/jquery-ui-1.10.3.js"></script>
<script src="~/Content/Scripts/bootstrap.js"></script>
<script src="/Content/Scripts/library/jquery.collapsible.min.js"></script>
<script src="~/Content/Scripts/library/jquery.mCustomScrollbar.min.js"></script>
<script src="~/Content/Scripts/library/jquery.mousewheel.min.js"></script>
<script src="~/Content/Scripts/library/jquery.uniform.min.js"></script>
<script src="~/Content/Scripts/library/jquery.collapsible.min.js"></script>
<script src="~/Content/Scripts/library/jquery.mCustomScrollbar.min.js"></script>
<script src="~/Content/Scripts/library/jquery.mousewheel.min.js"></script>
<script src="~/Content/Scripts/library/jquery.uniform.min.js"></script>
<script src="~/Content/Scripts/library/jquery.sparkline.min.js"></script>
<script src="~/Content/Scripts/library/chosen.jquery.min.js"></script>
<script src="~/Content/Scripts/library/jquery.easytabs.js"></script>
<script src="~/Content/Scripts/library/flot/excanvas.min.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.pie.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.selection.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.resize.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.orderBars.js"></script>
<script src="~/Content/Scripts/library/maps/jquery.vmap.js"></script>
<script src="~/Content/Scripts/library/maps/maps/jquery.vmap.world.js"></script>
<script src="~/Content/Scripts/library/maps/data/jquery.vmap.sampledata.js"></script>
<script src="~/Content/Scripts/library/jquery.autosize-min.js"></script>
<script src="~/Content/Scripts/library/charCount.js"></script>
<script src="~/Content/Scripts/library/jquery.minicolors.js"></script>
<script src="~/Content/Scripts/library/jquery.tagsinput.js"></script>
<script src="~/Content/Scripts/library/footable/footable.js"></script>
<script src="~/Content/Scripts/library/footable/data-generator.js"></script>
<script src="http://maps.googleapis.com/maps/api/js?key=AIzaSyCL6XtCGot7S7cfxnO6tRfeZx9kLQQRMtA&amp;sensor=false"></script>
<script src="~/Content/Scripts/library/jquery.sparkline.min.js"></script>
<script src="~/Content/Scripts/library/chosen.jquery.min.js"></script>
<script src="~/Content/Scripts/library/jquery.easytabs.js"></script>
<script src="~/Content/Scripts/library/flot/excanvas.min.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.pie.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.selection.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.resize.js"></script>
<script src="~/Content/Scripts/library/flot/jquery.flot.orderBars.js"></script>
<script src="~/Content/Scripts/library/maps/jquery.vmap.js"></script>
<script src="~/Content/Scripts/library/maps/maps/jquery.vmap.world.js"></script>
<script src="~/Content/Scripts/library/maps/data/jquery.vmap.sampledata.js"></script>
<script src="~/Content/Scripts/library/jquery.autosize-min.js"></script>
<script src="~/Content/Scripts/library/charCount.js"></script>
<script src="~/Content/Scripts/library/jquery.minicolors.js"></script>
<script src="~/Content/Scripts/library/jquery.tagsinput.js"></script>
<script src="~/Content/Scripts/library/fullcalendar.min.js"></script>
<script src="~/Content/Scripts/library/footable/footable.js"></script>
<script src="~/Content/Scripts/library/footable/data-generator.js"></script>
<script src="~/Content/Scripts/library/bootstrap-fileupload.js"></script>
<script src="~/Content/Scripts/library/jquery.inputmask.bundle.js"></script>
@*<script src="~/Content/Scripts/library/bootstrap-datetimepicker.js"></script>
    <script src="~/Content/Scripts/library/bootstrap-timepicker.js"></script>
    <script src="~/Content/Scripts/library/bootstrap-datepicker.js"></script>
    <script src="~/Content/Scripts/library/bootstrap-fileupload.js"></script>*@
<script src="~/Content/Scripts/library/jquery.inputmask.bundle.js"></script>
<script src="~/Content/Scripts/library/jquery.backstretch.min.js"></script>

<script src="~/Content/Scripts/library/jquery.inputmask.bundle.js"></script>

<script src="~/Content/Scripts/library/bootstrap-modal.js"></script>
<script src="~/Content/Scripts/library/bootstrap-modalmanager.js"></script>

<script src="~/Content/Scripts/flatpoint_core.js"></script>

<script src="~/Content/Scripts/forms.js"></script>
<script>
    jQuery("#save_chgPasswordExp").off("click.save");
    jQuery("#save_chgPasswordExp").on("click.save", function () {
        debugger;
        var inputsArray = jQuery("#user-customer_Form input[type=password]");
        var status = true;
        for (i = 0; i < inputsArray.length; i++) {
            input = jQuery(inputsArray[i]);
            var msg = input.closest("tr").find("h10").text().split(':')[0];

            if (input.val() == "") {
                jQuery("#messagesModal").html("<br /><p style='Color: red;'>Introduzca \"" + msg + "\"</p>");
                status = false;
                return false;
            }
            regExp = new RegExp(input.attr("pattern"));
            if (!input.val().match(regExp)) {
                jQuery("#messagesModal").html("<br /><p style='Color: red;'>Formato incorrecto para \"" + msg + "\"</p>");
                status = false;
                return false;
            }
            if (jQuery("#newPassword").val() != jQuery("#repeatNewPassword").val()) {
                jQuery("#messagesModal").html("<br /><p style='Color: red;'>Las contraseñas no coinciden</p>");
                status = false;
                return false;
            }
            jQuery("#messagesModal").html("<br /><p style='Color:black;'>Cargando..</p>");
            jQuery("#save_chgPasswordExp").attr("disabled", true);
           
        }

        var pass = jQuery("#newPassword").val();
        var key = jQuery("#keypwd").val();
        if (status) {
            jQuery.ajax({
                url: "/User/Login/newPassword",
                type: "POST",
                data: { key: key, password: pass },
                success: function (data) {
                    if (data != "success") {
                        jQuery("#messagesModal").html("<br /><p style='Color: red;'>"+data+"</p>");
                    } else {
                        jQuery("#messagesModal").html("<br /><p style='Color: green;'>Contraseña cambiada correctamente!</p>");
                        setTimeout(function () { window.location.href = "/User/Login"; }, 3000);
                    }
                    jQuery("#save_chgPasswordExp").prop("disabled", false);
                },
                error: function () {
                    alert("Ocurrio un error");
                    jQuery("#messagesModal").html("");
                    jQuery("#save_chgPasswordExp").prop("disabled", false);
                }

            });

        }



    });
</script>
