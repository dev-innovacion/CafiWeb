@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model JArray
@using MongoDB.Bson
@using Newtonsoft.Json;
@using Newtonsoft.Json.Linq;
@{

    Dictionary<string, string> cols = new Dictionary<string, string>();

    //foreach (var x in (Dictionary<string, string>)ViewData["cols"])
    //{
    //    cols.Add(x.Key, x.Value);
    //}
    
    int count = 0;

    int numusers = 0;
    string nameprofiles = "";
    string[] datesarray ;

    int numcols = 0;

}
<div class="row-fluid">
    <div id="reports" class="float_margen">
        <div class="container1  " style="max-height:500px;  padding: 0px 20px 25px 0px; ">
            @*<div class="row_fluid" style="  padding-bottom: 12%;">
                <div id="firstFilter" class="span3">
                    <div class="hida" style="padding-left: 2%;">
                        <input id="year1" type="checkbox" style="right:5px;display:none" title="Es fecha?" />
                        Primera Agrupación:
                    </div>
                    <select class="span11">
                        <option value="99">Elige una Columna</option>
                        <option value="module">Módulo</option>
                        <option value="movement">Movimiento</option>
                        <option value="collection">Tabla</option>
                        <option value="movementDate">Fecha</option>
                    </select>
                </div>
                <div id="secondFilter" class="span3" style="display:none">
                    <div class="hida" style="padding-left: 2%;">
                        <input id="year2" type="checkbox" style="right: 5px; display: none" title="Es fecha?" />

                        Segunda Agrupación:
                    </div>
                    <select class="span11">
                        <option value="99">Elige una Columna</option>
                        <option value="module">Módulo</option>
                        <option value="movement">Movimiento</option>
                        <option value="collection">Tabla</option>
                        <option value="movementDate">Fecha</option>
                    </select>
                </div>
                <div id="thridFilter" class="span3" style="display:none">
                    <div class="hida" style="padding-left: 2%;">
                        <input id="year3" type="checkbox" style="right: 5px; display: none" title="Es fecha?" />

                        Tercera Agrupación:
                    </div>
                    <select class="span11">
                        <option value="99">Elige una Columna</option>
                        <option value="module">Módulo</option>
                        <option value="movement">Movimiento</option>
                        <option value="collection">Tabla</option>
                        <option value="movementDate">Fecha</option>
                    </select>
                </div>
                <div class="span3">
                    <div class="hida" style="padding-left: 2%; padding-top: 7%;">

                        <input type="button" class="btn button_green" id="group" value="Agrupar" />
                        <input type="button" class="btn black" id="ungroup" value="Desagrupar" style=" margin-left: 8%;" />

                    </div>

                </div>
            </div>
            <br />*@
            <div class=" tablecustom">
                <table id="logtablex" class="table table-striped table-hover" style="max-height:400px;">

                    <thead style="">
                        <tr class="header">
                            <th class="table-fixed-medium" style="background: #8793A0; color: white;  text-align: center;font-size:12px;">Usuario</th>
                            <th class="table-fixed-medium" style="background: #8793A0; color: white;  text-align: center;font-size:12px;">Módulo</th>
                            <th class="table-fixed-medium" style="background: #8793A0; color: white;  text-align: center;font-size:12px;">Movimiento</th>
                            <th class="table-fixed-medium" style="background: #8793A0; color: white;  text-align: center;font-size:12px;">Tabla</th>
                            <th class="table-fixed-medium" style="background: #8793A0; color: white;  text-align: center;font-size:12px;">Fecha de Registro</th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (JObject item in Model)
                        {
                            <tr class="mailtr">
                                <td class="table-fixed-medium getmail" style="text-align:center;">

                                    @try
                                    {<Text>@item["username"].ToString() </Text>}
                                    catch (Exception ex)
                                    {
                                        <Text></Text>
                                    }
                                </td>
                                <td class="table-fixed-medium getmail" style="text-align:center;">
                                    @try
                                    {<Text>@item["module"].ToString() </Text>}
                                    catch (Exception ex)
                                    {
                                        <Text></Text>
                                    }
                                </td>
                                <td class="table-fixed-medium getmail" style="text-align:center;">
                                    @try
                                    {<Text>@item["movement"].ToString() </Text>}
                                    catch (Exception ex)
                                    {
                                        <Text></Text>
                                    }
                                </td>
                                <td class="table-fixed-medium getmail" style="text-align:center;">
                                    @try
                                    {<Text>@item["collection"].ToString() </Text>}
                                    catch (Exception ex)
                                    {
                                        <Text></Text>
                                    }
                                </td>
                                <td class="table-fixed-medium getmail" style="text-align:center;">
                                    @try
                                    {<Text>@item["movementDate"].ToString() </Text>}
                                    catch (Exception ex)
                                    {
                                        <Text></Text>
                                    }
                                </td>

                            </tr>

                                    count++;
                        }

                    </tbody>

                </table>
            </div>
          

            @*@if (count == 0)
            {
                <div>
                    <br />
                    <h4>  NO HAY REGISTROS</h4>

                </div>

            }*@
        </div>
    </div>
</div>

@section scripts{
    <script src="~/RivkaBase/Scripts/RivkaViewer2/RivkaViewer.js"></script>
    <script src="~/RivkaBase/Scripts/RivkaTree/RivkaTree.js"></script>

    <script type="text/javascript">
        try {
            jQuery("#logtablex").dataTable({
                "sPaginationType": "full_numbers",
                "sDom": "<'tableHeader'<l><'clearfix'f>r>t<'tableFooter'<i><'clearfix'p>>",
                "iDisplayLength": 10,
                "sScrollY": "400px",
                "oLanguage": {
                    "sLengthMenu": "Mostrar _MENU_ registros",
                    "sInfo": "Mostrando del _START_ al _END_ de _TOTAL_ registros",
                    "sSearch": "Filtro",
                    "oPaginate": {
                        "sFirst": "Primero",
                        "sLast": "Ultimo",
                        "sNext": "Siguiente",
                        "sPrevious": "Anterior"

                    },
                    "sEmptyTable": "Tabla Sin Datos"
                }
            });

            headers1()
        } catch (e) { }
        var options = {
            id: "_id",
            name: "username",
            permissions: [],
            defaultGrouping: "null",

            columnNames: { "username": "Usuario", "module": "Modulo", "movement": "Movimiento", "collection": "Tabla", "movementDate": "Fecha de Registro" },
            columnShow: {
                "username": 1, "module": 1, "movement": 1, "collection": 1, "movementDate": 1
            },
            displayConfiguration: {
                tableOptions: {
                    onEditRowAction:null,
                    onDeleteRowAction: null,
                    onSelectRowAction: null,
                }
            }
        };

        var objectsViewer = new RivkaViewer("objectsTab", options);
        objectsViewer.setDisplayMethod(RivkaViewer.METHODS.TABLE, options);

        var model = {
            parentCategory: location.hash == "" ? "null" : location.hash.substring(1),

            indexpag: 0,
            indextotal: 0,
            idcurrent:"",
            selectedID: null,

            routeData: null,

            objectsData: null,

            tableobject: null,

            init: function () {
                    jQuery.ajax({
                        url: "/LogBook/LogBook/getData",
                        type: "POST",
                        beforeSend: _loading(),
                        success: function (data) {
                          //  var data = JSON.parse(data);
                            model.objectsData = data;
                            
                            objectsViewer.setData(model.objectsData);
                            objectsViewer.printView();
                            _loading();
                            //var objs = [{ type: "text" }];
                            //try{
                            //    for (var i in options.columnShow) {
                            //        if (options.columnShow[i] == 1) objs.push({ type: "text" });
                            //    }
                            //} catch (ex) {

                            //}
                            //headers1();
                        },
                        error: function (errorThrown) {
                        }
                    });
            }
        };

        function headers1() {
            setTimeout(function () {
                var table = jQuery("#logtablex").dataTable();
                table.fnAdjustColumnSizing();

            }, 2000);


        }

        //function creararray() {
        //    var array1 = [];
        //    for (var i = 0; i < 500000; i++) {
        //        var obj1 = { "caso": "wawa", "changos": "wewew" };
        //        array1.push(obj1);
        //    }

        //    var cadena = "";
        //    for (var i = 0; i < 500000;i++) {
        //        cadena = cadena + "<tr><td>" + array1[i].changos +i.toString()+ "</td></tr>";
        //    }

        //    jQuery("#logtablex tbody").html(cadena);
        //}
    jQuery(document).ready(function (jQuery) {
       // model.init();
      


        
    });

    //----------------------------------------------------------------------------------------------

    </script>
}